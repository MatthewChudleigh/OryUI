@page "/identities/{UserId}/edit"
@attribute [StreamRendering(true)]
@inject ICustomTranslator Translator
@inject ILogger<Home> Logger
@inject NavigationManager Navigation
@attribute [RenderModeServer]

<PageTitle>Edit Identity</PageTitle>

<section class="section mt-5">
    <h1 class="title">Edit Identity</h1>

    @if (_isLoading)
    {
        // is loading
        <p>Loading data...</p>
    }
    else
    {
        <form @onsubmit="SubmitForm">
            @foreach (var schema in _traitSchemas!)
            {
                var value = IdentityService.GetTraitValueFromPath(_json!, schema.Path);
                <div class="field">
                    <label class="label">
                        @schema.Schema.Title
                        <div class="control">
                            <input type="text" class="input" required="@schema.Schema.Required"
                                   value="@value" id="@schema.Schema.Id"
                                   @onchange="args => UpdateValue(schema, args)"/>
                        </div>
                    </label>
                </div>
            }
            <div class="message is-warning p-2 @(string.IsNullOrWhiteSpace(_errorMessage) ? "is-hidden" : "")">
                @_errorMessage
            </div>
            <div class="mt-5">
                <div class="buttons">
                    <NavLink class="button" @onclick="Cancel">
                        Cancel
                    </NavLink>
                    <button type="submit" class="button is-success">
                        Save
                    </button>
                </div>
            </div>
        </form>
    }
</section>